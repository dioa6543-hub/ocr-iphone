<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>OCR iPhone / PC â€“ icÃ´ne complÃ¨te</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- IcÃ´nes : PC + iPhone -->
  <link rel="icon" type="image/png" href="https://dioa6543-hub.github.io/ocr-iphone/logo.png">
  <link rel="apple-touch-icon" sizes="512x512" href="https://dioa6543-hub.github.io/ocr-iphone/logo.png">
  <style>
    /* fond JPG partout */
    html,body{margin:0;height:100%;background:url("image.jpg") center/cover no-repeat fixed;font-family:system-ui;color:#fff;text-shadow:0 0 4px #000}
    /* barre de recherche (logo PNG) */
    #searchBar{display:flex;align-items:center;justify-content:center;padding:.6rem;background:rgba(0,0,0,.25);border-radius:8px;margin:1rem auto;max-width:600px}
    #searchBar img{height:40px;margin-right:10px}
    #searchBar input{flex:1;padding:.5rem;font-size:1rem;border:none;border-radius:4px;background:rgba(255,255,255,.9);color:#000}
    button{width:100%;max-width:400px;padding:.9rem;font-size:1.2rem;margin:.5rem auto;display:block}
    textarea{width:100%;max-width:600px;height:180px;font-size:1rem;margin:auto;display:block}
    #video{width:100%;max-width:600px;border:1px solid #ccc;margin:auto;display:block}
    .pcOnly{display:none} @media (min-width:900px){.pcOnly{display:block}}
  </style>
</head>
<body>

<!-- barre de recherche : logo PNG -->
<div id="searchBar">
  <img src="logo.png" alt="logo">
  <input type="text" placeholder="Recherche (dÃ©co)">
</div>

<h1 style="text-align:center">ğŸ“· OCR iPhone / PC</h1>

<!-- iPhone -->
<button id="openCam">ğŸ“· Autoriser camÃ©ra</button>
<video id="video" playsinline autoplay></video>
<button id="snapBtn" disabled>ğŸ“¸ Prendre photo</button>

<!-- PC -->
<div class="pcOnly">
  <input type="file" id="fileInput" accept="image/*,.pdf" class="pcOnly">
  <button id="scanFileBtn" disabled>ğŸ” Scanner le fichier</button>
</div>

<!-- OCR -->
<button id="scanBtn" disabled>ğŸ” Lancer OCR</button>

<!-- RÃ©sultat -->
<h3 style="text-align:center">Texte :</h3>
<textarea id="out" placeholder="Texte apparaÃ®tra iciâ€¦"></textarea>

<!-- Actions -->
<button id="saveBtn">ğŸ’¾ Enregistrer le texte</button>
<button id="readBtn">ğŸ”Š Lire</button>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
  /* camÃ©ra + OCR + sauvegarde + voix */
  const video=document.getElementById('video'),openCam=document.getElementById('openCam'),snapBtn=document.getElementById('snapBtn'),scanBtn=document.getElementById('scanBtn'),out=document.getElementById('out'),saveBtn=document.getElementById('saveBtn'),readBtn=document.getElementById('readBtn'),fileInput=document.getElementById('fileInput'),scanFileBtn=document.getElementById('scanFileBtn');
  let stream,imgBlob;
  openCam.onclick=async()=>{try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});video.srcObject=stream;snapBtn.disabled=false;}catch(e){alert('CamÃ©ra refusÃ©e â€“ HTTPS + Safari');}};
  snapBtn.onclick=()=>{const c=document.createElement('canvas');c.width=video.videoWidth;c.height=video.videoHeight;c.getContext('2d').drawImage(video,0,0);c.toBlob(b=>{imgBlob=b;scanBtn.disabled=false;},'image/png');};
  fileInput.onchange=e=>{imgBlob=fileInput.files[0];scanFileBtn.disabled=!imgBlob;};
  scanFileBtn.onclick=()=>doOCR(imgBlob); scanBtn.onclick=()=>doOCR(imgBlob);
  async function doOCR(b){out.value='â³ OCRâ€¦';const w=await Tesseract.createWorker('fra');try{const r=await w.recognize(b);out.value=r.data.text;}catch(err){out.value='Erreur : '+err.message;}finally{w.terminate();}}
  saveBtn.onclick=()=>{const b=new Blob([out.value],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='texte_ocr.txt';a.click();URL.revokeObjectURL(u);}
  readBtn.onclick=()=>{const u=new SpeechSynthesisUtterance(out.value);u.lang='fr-FR';speechSynthesis.speak(u);}
</script>

</body>
</html>

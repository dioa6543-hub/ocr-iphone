<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>OCR multi â€“ choisir fichier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://dioa6543-hub.github.io/ocr-iphone/logo.png">
  <link rel="apple-touch-icon" sizes="512x512" href="https://dioa6543-hub.github.io/ocr-iphone/logo.png">
  <style>
    html,body{margin:0;height:100%;background:url("image.jpg") center/cover no-repeat fixed;font-family:system-ui;color:#fff;text-shadow:0 0 4px #000}
    #searchBar{display:flex;align-items:center;justify-content:center;padding:.6rem;background:rgba(0,0,0,.25);border-radius:8px;margin:1rem auto;max-width:600px}
    #searchBar img{height:40px;margin-right:10px}#searchBar input{flex:1;padding:.5rem;font-size:1rem;border:none;border-radius:4px;background:rgba(255,255,255,.9);color:#000}
    button{width:100%;max-width:400px;padding:.9rem;font-size:1.2rem;margin:.5rem auto;display:block}
    textarea{width:100%;max-width:600px;height:180px;font-size:1rem;margin:auto;display:block}
    #video{width:100%;max-width:600px;border:1px solid #ccc;margin:auto;display:block}
    .pcOnly{display:none}@media (min-width:900px){.pcOnly{display:block}}
    #langBox{text-align:center;margin:1rem auto;max-width:600px;background:rgba(0,0,0,.4);border-radius:8px;padding:.5rem}
    #langBox select{font-size:1rem;padding:.3rem}
    #dropZone{border:2px dashed #ccc;border-radius:8px;padding:2rem;text-align:center;margin:1rem auto;max-width:600px}
  </style>
</head>
<body>

<!-- Langue -->
<div id="langBox">
  <label>ğŸŒ Langue : </label>
  <select id="langSel">
    <option value="fr">FranÃ§ais</option>
    <option value="en">English</option>
    <option value="es">EspaÃ±ol</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="zh">ä¸­æ–‡</option>
  </select>
</div>

<!-- barre logo -->
<div id="searchBar"><img src="logo.png" alt="logo"><input type="text" placeholder="Recherche (dÃ©co)"></div>
<h1 style="text-align:center" id="title">ğŸ“· OCR iPhone / PC</h1>

<!-- iPhone -->
<button id="openCam">ğŸ“· Autoriser camÃ©ra</button>
<video id="video" playsinline autoplay></video>
<button id="snapBtn" disabled>ğŸ“¸ Prendre photo</button>

<!-- PC : bouton + glisser-dÃ©poser -->
<div class="pcOnly">
  <button id="chooseBtn">ğŸ“ Choisir un fichier</button>
  <input type="file" id="fileInput" accept="image/*,.pdf" style="display:none">
  <div id="dropZone">Ou glisse-dÃ©pose une image ici<br><small>jpg, png, pdf</small></div>
  <button id="scanFileBtn" disabled>ğŸ” Scanner le fichier</button>
</div>

<!-- OCR -->
<button id="scanBtn" disabled>ğŸ” Lancer OCR</button>

<!-- Texte brut -->
<h3 id="rawTitle">Texte brut :</h3>
<textarea id="rawText" placeholder="Texte apparaÃ®tra iciâ€¦"></textarea>

<!-- LONGUEUR + BOUTON TRADUIT -->
<div id="longBox">
  <label id="lenLabel">Ne garder que les lignes â‰¥ <input type="number" id="minLen" value="20" min="1" max="999"> caractÃ¨res</label>
  <button id="applyBtn">Appliquer</button>
</div>

<!-- Texte filtrÃ© -->
<h3 id="outTitle">Texte filtrÃ© :</h3>
<textarea id="out" placeholder="Texte filtrÃ© iciâ€¦"></textarea>

<!-- Actions -->
<button id="saveBtn">ğŸ’¾ Enregistrer le texte</button>
<button id="readBtn">ğŸ”Š Lire</button>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
  /* TRADUCTIONS */
  const texts={
    fr:{chooseBtn:"ğŸ“ Choisir un fichier",dropZone:"Ou glisse-dÃ©pose une image ici",openCam:"ğŸ“· Autoriser camÃ©ra",snapBtn:"ğŸ“¸ Prendre photo",scanFileBtn:"ğŸ” Scanner le fichier",scanBtn:"ğŸ” Lancer OCR",rawTitle:"Texte brut :",outTitle:"Texte filtrÃ© :",lenLabel:"Ne garder que les lignes â‰¥",applyBtn:"Appliquer",saveBtn:"ğŸ’¾ Enregistrer le texte",readBtn:"ğŸ”Š Lire",placeholderRaw:"Texte apparaÃ®tra iciâ€¦",placeholderOut:"Texte filtrÃ© iciâ€¦",noLine:"Aucune ligne ne dÃ©passe la longueur choisie."},
    en:{chooseBtn:"ğŸ“ Choose file",dropZone:"Or drag & drop an image here",openCam:"ğŸ“· Allow camera",snapBtn:"ğŸ“¸ Take photo",scanFileBtn:"ğŸ” Scan file",scanBtn:"ğŸ” Launch OCR",rawTitle:"Raw text :",outTitle:"Filtered text :",lenLabel:"Keep lines â‰¥",applyBtn:"Apply",saveBtn:"ğŸ’¾ Save text",readBtn:"ğŸ”Š Read",placeholderRaw:"Text will appear hereâ€¦",placeholderOut:"Filtered text hereâ€¦",noLine:"No line exceeds the chosen length."},
    es:{chooseBtn:"ğŸ“ Elegir archivo",dropZone:"O arrastra y suelta una imagen aquÃ­",openCam:"ğŸ“· Permitir cÃ¡mara",snapBtn:"ğŸ“¸ Tomar foto",scanFileBtn:"ğŸ” Escanear archivo",scanBtn:"ğŸ” Lanzar OCR",rawTitle:"Texto bruto :",outTitle:"Texto filtrado :",lenLabel:"Mantener lÃ­neas â‰¥",applyBtn:"Aplicar",saveBtn:"ğŸ’¾ Guardar texto",readBtn:"ğŸ”Š Leer",placeholderRaw:"El texto aparecerÃ¡ aquÃ­â€¦",placeholderOut:"Texto filtrado aquÃ­â€¦",noLine:"Ninguna lÃ­nea supera la longitud elegida."},
    ar:{chooseBtn:"ğŸ“ Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§",dropZone:"Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª ØµÙˆØ±Ø© Ù‡Ù†Ø§",openCam:"ğŸ“· Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§",snapBtn:"ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©",scanFileBtn:"ğŸ” Ù…Ø³Ø­ Ø§Ù„Ù…Ù„Ù",scanBtn:"ğŸ” ØªØ´ØºÙŠÙ„ OCR",rawTitle:"Ø§Ù„Ù†Øµ Ø§Ù„Ø®Ø§Ù… :",outTitle:"Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØµÙÙ‰ :",lenLabel:"Ø§Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø·Ø± â‰¥",applyBtn:"ØªØ·Ø¨ÙŠÙ‚",saveBtn:"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†Øµ",readBtn:"ğŸ”Š Ø§Ø³ØªÙ…Ø¹",placeholderRaw:"Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ù‡Ù†Ø§â€¦",placeholderOut:"Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØµÙÙ‰ Ù‡Ù†Ø§â€¦",noLine:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø·Ø± ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±."},
    zh:{chooseBtn:"ğŸ“ é€‰æ‹©æ–‡ä»¶",dropZone:"æˆ–åœ¨æ­¤å¤„æ‹–æ”¾å›¾åƒ",openCam:"ğŸ“· å…è®¸ç›¸æœº",snapBtn:"ğŸ“¸ æ‹ç…§",scanFileBtn:"ğŸ” æ‰«ææ–‡ä»¶",scanBtn:"ğŸ” å¯åŠ¨OCR",rawTitle:"åŸå§‹æ–‡æœ¬ :",outTitle:"è¿‡æ»¤æ–‡æœ¬ :",lenLabel:"ä¿ç•™è¡Œ â‰¥",applyBtn:"åº”ç”¨",saveBtn:"ğŸ’¾ ä¿å­˜æ–‡æœ¬",readBtn:"ğŸ”Š æœ—è¯»",placeholderRaw:"æ–‡æœ¬å°†å‡ºç°åœ¨è¿™é‡Œâ€¦",placeholderOut:"è¿‡æ»¤æ–‡æœ¬åœ¨è¿™é‡Œâ€¦",noLine:"æ²¡æœ‰è¡Œè¶…è¿‡æ‰€é€‰é•¿åº¦ã€‚"}
  };

  /* Traduction dynamique */
  const langSel=document.getElementById('langSel');
  const els={
    chooseBtn:document.getElementById('chooseBtn'),dropZone:document.getElementById('dropZone'),title:document.getElementById('title'),openCam:document.getElementById('openCam'),snapBtn:document.getElementById('snapBtn'),scanFileBtn:document.getElementById('scanFileBtn'),scanBtn:document.getElementById('scanBtn'),rawTitle:document.getElementById('rawTitle'),outTitle:document.getElementById('outTitle'),lenLabel:document.getElementById('lenLabel'),applyBtn:document.getElementById('applyBtn'),saveBtn:document.getElementById('saveBtn'),readBtn:document.getElementById('readBtn'),rawText:document.getElementById('rawText'),out:document.getElementById('out'),minLen:document.getElementById('minLen'),dropZone:document.getElementById('dropZone')
  };
  function setLang(l){
    const t=texts[l];
    Object.keys(t).forEach(k=>{if(els[k])els[k].textContent=t[k];});
    els.rawText.placeholder=t.placeholderRaw; els.out.placeholder=t.placeholderOut;
    localStorage.setItem('ocrLang',l);
  }
  langSel.onchange=()=>setLang(langSel.value);
  const saved=localStorage.getItem('ocrLang'); if(saved) langSel.value=saved;
  setLang(langSel.value);

  /* Bouton Â« Choisir un fichier Â» */
  const chooseBtn=document.getElementById('chooseBtn');
  const fileInput=document.getElementById('fileInput');
  chooseBtn.onclick=()=>fileInput.click();
  fileInput.onchange=e=>{imgBlob=fileInput.files[0];scanFileBtn.disabled=!imgBlob;};

  /* Glisser-dÃ©poser */
  const dropZone=document.getElementById('dropZone');
  dropZone.ondragover=e=>{e.preventDefault(); dropZone.style.borderColor='#fff';};
  dropZone.ondragleave=e=>{e.preventDefault(); dropZone.style.borderColor='#ccc';};
  dropZone.ondrop=e=>{
    e.preventDefault(); dropZone.style.borderColor='#ccc';
    const f=e.dataTransfer.files[0];
    if(f&&(f.type.match(/image\/|application\/pdf/))){imgBlob=f;scanFileBtn.disabled=false;}
  };

  /* CamÃ©ra iPhone */
  const video=document.getElementById('video'),openCam=document.getElementById('openCam'),snapBtn=document.getElementById('snapBtn'),scanBtn=document.getElementById('scanBtn'),scanFileBtn=document.getElementById('scanFileBtn'),out=document.getElementById('out'),saveBtn=document.getElementById('saveBtn'),readBtn=document.getElementById('readBtn'),applyBtn=document.getElementById('applyBtn');
  let stream,imgBlob;
  openCam.onclick=async()=>{try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});video.srcObject=stream;snapBtn.disabled=false;}catch(e){alert('CamÃ©ra refusÃ©e â€“ HTTPS + Safari');}};
  snapBtn.onclick=()=>{const c=document.createElement('canvas');c.width=video.videoWidth;c.height=video.videoHeight;c.getContext('2d').drawImage(video,0,0);c.toBlob(b=>{imgBlob=b;scanBtn.disabled=false;},'image/png');};
  scanFileBtn.onclick=()=>doOCR(imgBlob); scanBtn.onclick=()=>doOCR(imgBlob);
  async function doOCR(b){const raw=document.getElementById('rawText'); raw.value='â³ OCRâ€¦';const w=await Tesseract.createWorker('fra');try{const r=await w.recognize(b);raw.value=r.data.text;}catch(err){raw.value='Erreur : '+err.message;}finally{w.terminate();}}
  applyBtn.onclick=()=>{
    const seuil=parseInt(minLen.value,10)||1;
    const lignes=document.getElementById('rawText').value.split(/\r?\n/).filter(l=>l.length>=seuil);
    out.value=lignes.join('\n');
    const t=texts[langSel.value]; if(!lignes.length) alert(t.noLine||'Aucune ligne ne dÃ©passe la longueur choisie.');
  };
  saveBtn.onclick=()=>{const b=new Blob([out.value],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='texte_ocr.txt';a.click();URL.revokeObjectURL(u);}
  readBtn.onclick=()=>{const u=new SpeechSynthesisUtterance(out.value);u.lang='fr-FR';speechSynthesis.speak(u);}
</script>

</body>
</html>

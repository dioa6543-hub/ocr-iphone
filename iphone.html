<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>OCR iPhone / PC â€“ fond JPG + PNG ou icÃ´ne</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    /* fond JPG partout */
    html,body{
      margin:0;
      height:100%;
      background:url("image.jpg") center/cover no-repeat fixed;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#fff;
      text-shadow:0 0 4px #000;
    }
    button{width:100%;max-width:400px;padding:.9rem;font-size:1.2rem;margin:.5rem auto;display:block}
    textarea{width:100%;max-width:600px;height:180px;font-size:1rem;margin:auto;display:block}
    #video{width:100%;max-width:600px;border:1px solid #ccc;margin:auto;display:block}
    #pngIco{width:120px;height:120px;margin:1rem auto;display:block;border-radius:8px;object-fit:contain}
    #dropZone{
      border:2px dashed #ccc;
      border-radius:8px;
      padding:2rem;
      text-align:center;
      margin:1rem auto;
      max-width:600px;
    }
    .pcOnly{display:none} /* on va lâ€™afficher sous Windows */
    @media (min-width:900px){
      .pcOnly{display:block}
    }
  </style>
</head>
<body>

  <h1 style="text-align:center">ğŸ“· OCR iPhone / PC</h1>

  <!-- image PNG ou icÃ´ne par dÃ©faut -->
  <img id="pngIco" alt="icÃ´ne">

  <!-- Bouton iPhone -->
  <button id="openCam">ğŸ“· Autoriser camÃ©ra</button>
  <video id="video" playsinline autoplay></video>
  <button id="snapBtn" disabled>ğŸ“¸ Prendre photo</button>

  <!-- Zone PC (Windows, Linux, Mac) -->
  <div class="pcOnly">
    <div id="dropZone">Ou glisse-dÃ©pose une image ici<br><small>jpg, png, pdf</small></div>
    <input type="file" id="fileInput" accept="image/*,.pdf" class="pcOnly">
    <button id="scanFileBtn" disabled>ğŸ” Scanner le fichier</button>
  </div>

  <!-- OCR -->
  <button id="scanBtn" disabled>ğŸ” Lancer OCR</button>

  <!-- RÃ©sultat -->
  <h3 style="text-align:center">Texte :</h3>
  <textarea id="out" placeholder="Texte apparaÃ®tra iciâ€¦"></textarea>

  <!-- Actions -->
  <button id="saveBtn">ğŸ’¾ Enregistrer le texte</button>
  <button id="readBtn">ğŸ”Š Lire</button>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script>
    /* 1. Affiche image.png si elle existe, sinon icÃ´ne camÃ©ra */
    const ico=document.getElementById('pngIco');
    fetch('image.png')
      .then(r=>r.ok?ico.src='image.png':ico.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTEyIDE1YTMgMyAwIDEwMC02IDMgMyAwIDAwMCA2eiIvPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0yMCA1aC0zLjE3TDE1IDNIOUw3LjE3IDVINGEyIDIgMCAwMC0yIDJ2MTFhMiAyIDAgMDAyIDJoMTZhMiAyIDAgMDAyLTJWN2EyIDIgMCAwMC0yLTJ6bS0zIDEyaC02di0yaDZ2MnptMC00aC02di0yaDZ2MnptLTQgNEg4di0yaDZ2MnoiLz48L3N2Zz4=');

    /* 2. CamÃ©ra (iPhone) */
    const video=document.getElementById('video');
    const openCam=document.getElementById('openCam');
    const snapBtn=document.getElementById('snapBtn');
    const scanBtn=document.getElementById('scanBtn');
    const out=document.getElementById('out');
    const saveBtn=document.getElementById('saveBtn');
    const readBtn=document.getElementById('readBtn');
    const fileInput=document.getElementById('fileInput');
    const scanFileBtn=document.getElementById('scanFileBtn');
    const dropZone=document.getElementById('dropZone');

    let stream, imgBlob;

    /* ----- iPhone ----- */
    openCam.onclick=async()=>{
      try{
        stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});
        video.srcObject=stream;
        snapBtn.disabled=false;
      }catch(e){alert('CamÃ©ra refusÃ©e â€“ HTTPS + Safari requis');}
    };
    snapBtn.onclick=()=>{
      const canvas=document.createElement('canvas');
      canvas.width=video.videoWidth; canvas.height=video.videoHeight;
      canvas.getContext('2d').drawImage(video,0,0);
      canvas.toBlob(blob=>{imgBlob=blob; scanBtn.disabled=false;},'image/png');
    };

    /* ----- PC Windows / Linux / Mac ----- */
    fileInput.onchange=e=>{
      imgBlob=fileInput.files[0];
      scanFileBtn.disabled=!imgBlob;
    };
    scanFileBtn.onclick=()=>doOCR(imgBlob);

    /* glisser-dÃ©poser */
    dropZone.ondragover=e=>{e.preventDefault(); dropZone.style.borderColor='#fff';};
    dropZone.ondragleave=e=>{e.preventDefault(); dropZone.style.borderColor='#ccc';};
    dropZone.ondrop=e=>{
      e.preventDefault(); dropZone.style.borderColor='#ccc';
      const f=e.dataTransfer.files[0];
      if(f && (f.type.match(/image\/|application\/pdf/))){imgBlob=f; scanFileBtn.disabled=false;}
    };

    /* ----- OCR commun ----- */
    scanBtn.onclick=()=>doOCR(imgBlob);

    function doOCR(blob){
      out.value='â³ OCR en coursâ€¦';
      const worker=await Tesseract.createWorker('fra');
      try{
        const ret=await worker.recognize(blob);
        out.value=ret.data.text;
      }catch(err){out.value='Erreur : '+err.message;}
      finally{worker.terminate();}
    }

    /* ----- Sauvegarde & voix ----- */
    saveBtn.onclick=()=>{
      const b=new Blob([out.value],{type:'text/plain'});
      const u=URL.createObjectURL(b);
      const a=document.createElement('a');
      a.href=u; a.download='texte_ocr.txt'; a.click();
      URL.revokeObjectURL(u);
    };
    readBtn.onclick=()=>{
      const u=new SpeechSynthesisUtterance(out.value);
      u.lang='fr-FR'; speechSynthesis.speak(u);
    };
  </script>

</body>
</html>
